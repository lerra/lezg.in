[{"categories":["documentation"],"content":"This post will guide you through on how do connect a dumb coffee machine to be connected to home assistant and the possibility to add it to your automated morning routine.","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"This post will guide you through on how do connect a dumb coffee machine to be connected to your home automation and the possibility to add it to your automated morning routine. IOT enabling my grind and brew coffee machine ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:0:0","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Hardware Philips Grind \u0026 Brew HD7762 Esp32 devkit c v4 I used Esp32 devkit c v4 30-pin but almost any esp32 will do as long as you use the right pin’s Non-contact liquid sensor from CQRobot cables \u0026 usb power adapter. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:1:0","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Repository github ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:2:0","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"The story A couple of years ago, I started with a wake-up routine with my privacy first home automation. Waking up to an emulated sunrise with red, transforming to yellow and then to normal light over a period of fifteen minutes and then, the TV kicking on the circle of life from the Lion king movie. I could start up every morning with a smile and less grumpy. So I started to think, what’s missing to make my mornings even more awesome. The idea with having fresh coffee would be a great. The only problem I had then was the time, then came the pandemic and time was something I gotta a shit loads of. I already had some wires, esp’s and relays already but I was unsure how the inside of the coffee machine was wired. I was speaking to my friend Peter over the phone that is so deep into the electronics that it is insane and I told him about what I was planning to do. He said that I might not need a relay to do this and could use the esp to do this depending on the voltage. He found the service manual online and was checking it, but could not find any details about the circuit board and without me thinking it through, we started to disassemble it. One hour later, I measured with the multimeter to see where to hook in to the circuit and we identified that the voltage is 4.3v and Peter told me that the ESP only supports 3.6V. We decided to test it out anyway and the sacrifice a ESP if it would get killed during the test as other have successfully been running even with 5V. The benefit of a successful test would be one less component (the relay). The circuit board was a lot more dense than I thought and I have not soldered in 20 years, so we agreed that we would meet up to get some help and also learn how to do it my self. It took a month before we did that due to the pandemic. Now, working from home and no coffee for a month was challenging. Meanwhile, I ordered the Non-contact liquid sensor from CQRobot to be able to detect water through the plastic container (it also works through glas). With the sensor in place, I could make sure to not turn on the grinding process if the machine was not prepared. Acter a couple of weeks, I got sensor and started to play around with it and also identifying exactly where to put the sensor. Its a really cool one and works by using the sensing capacitance of water and gives back a binary value as a result. So, after a month when we met and started to soldered the cables to ground, the “turn on” button and the “start grinding” button. We did a test with the on button and ground connected to see if we needed a relay or not, eventually a new ESP if it would get burned during the test. It turned out that the ESP could manage it and you can see it turning on the coffee machine (the red light on the circuit). void setup() { pinMode(15, OUTPUT); } void loop() { digitalWrite(15,HIGH); delay(5000); digitalWrite(15, LOW); delay(500); } ESP32 testingTesting the code on the ESP32 to see if we need a relay or not \" Testing the code on the ESP32 to see if we need a relay or not The right molder is the on switch and the left one is the gind switch and ground was connected here So, I started to evolve the code and halfway there I bumped over an article in my rss reader about a home assistant project built upon esphome. I realized I was looking into that project a while ago but forget the existense. Even if I have invested some time into the code, I realized that I would never come close to the features esphome. It is tightly integrated with home assistant, the possibility to update the code with the OTA (Over The Air, no need for a usb cable to debug or deploy) and a real time event source api for state \u0026 log updates and a rest api, both over json. So I ported the code to the esphome yaml format and finished it. Bellow you can see what PIN’s I used for the ESP32 30-pinout The PIN D27 is connected to the “turn on” button on the circuit, D26 is connected to the “start grinding” and ground to ground. For the CQRobot senso","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:3:0","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Making the coffe machine smart So, what what do I mean by “smart”? From how I see it, when I can connect the coffee machine to a something bigger. So the key is to combine it with other sensors and triggers through the privacy first home automation, home assistant. I have been using it for almost four years and it is really powerfull and open. You can dig deeper into how to get started and the crazy amount of integrations. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:4:0","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"The morning routine (or ritual) Since two years years ago, I started with a wake-up routine. Waking up to an emulated sunrise with red, transforming to yellow and then to normal light over a period of fifteen minutes. After a while, the TV turns on and starts the morning music with Circle of life from the Lion king movie in the front. With this, I started my mornings with a smile and less grumpy. Since I got the coffee machine a part of the home automation setup, I now start grund \u0026 brewing when a motion sensor is triggered outside of the bedroom. This is also switching the wakeup music to the morning news channel. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:4:1","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Work from home coffee breaks This is a fun feature I tested but don’t really use but worth sharing. By using the home assistant precense feature we can have use a state if a device or a person is home or on. This could be a app on your phone reporting GPS cordinates, your work laptop connected to your network. As I am using the ESP32 that controls the coffee machine, I can also use esphome report signal measurement for specific bluetooth device (smartwatch, phone etc) and decide how close it is to the coffee machine. During a test I started the coffee machine during a timeslot and when precense of multiple devices but its not that useful as the WFH setup during the pandemic is in the kitchen close by the coffee machine. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:4:2","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Start by voice You can start it by voice with the privacy first voice support of home assistant by saying \"turn on coffee maker\". Honestly, the voice functionality in home assistant is limited, it's more a show then useful as you need to start the app and then go to voice / chat mode to then speak. But if you don’t mind to have a voice assistant such as alexa or google home in your home you can get use that to kick off the coffee and then its allot more useful. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:4:3","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Start by dropping the magic cube Starting the grinding and brewing of the coffee by dropping the aquara magic cubeStarting the grinding and brewing by dropping the aquara magic cube \" Starting the grinding and brewing by dropping the aquara magic cube I have several Aquara Magic Cube and I use the drop motion to kickoff the coffee machine. It’s a perfect motion when you are lazy and watching TV or in bed during the weekend when there is no wakeup routine. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:4:4","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"},{"categories":["documentation"],"content":"Start through the app This is probably the most used way we get our fresh coffee and it’s really nice to kick off by the end of a power walk to have it ready and fresh when we enter our home. Security Esphome does not (yet) support ssl/tls if you dont run a ESP8266 but it is a poor and unsecure implementation. I recommend to have separate network segments for both the server \u0026 esp32, firewall the communication and use separate wpa2 ssid for the device untill there is a secure feature. Creds Creds goes to the home assistant \u0026 esphome team, platform and frameworks they have built is really fantastic and I hope I could drive more users to a privacy first setup and Peter for pushing me during several years to get into the microcontrollers and electronics. More stuff is coming! PS. No ESP32 got killed or hurted during the test, mine have been running fine with 4.3V for two months at the time of writing this article. ","date":"2021-02-09","objectID":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/:4:5","tags":null,"title":"Adding a API to my grind and brew coffee machine and making it smart","uri":"/adding-a-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"}]