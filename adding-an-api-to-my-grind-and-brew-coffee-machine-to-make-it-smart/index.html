<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<title class=pjax-title>Adding an API to my grind and brew coffee machine to make it smart - Lezgin Bakircioglu's personal space</title><meta name=Description content="This post will guide you through on how to connect a dumb Philips grind & brew hd7762 coffee machine to your privacy first home automation solution based on home assistant and esphome. Most important, with a high Wife Acceptance Factor."><meta property="og:title" content="Adding an API to my grind and brew coffee machine to make it smart">
<meta property="og:description" content="This post will guide you through on how to connect a dumb Philips grind & brew hd7762 coffee machine to your privacy first home automation solution based on home assistant and esphome. Most important, with a high Wife Acceptance Factor.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/"><meta property="og:image" content="https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-02-19T21:29:01+08:00">
<meta property="article:modified_time" content="2022-01-11T11:37:04+01:00"><meta property="og:site_name" content="Lezgin Bakircioglu">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg">
<meta name=twitter:title content="Adding an API to my grind and brew coffee machine to make it smart">
<meta name=twitter:description content="This post will guide you through on how to connect a dumb Philips grind & brew hd7762 coffee machine to your privacy first home automation solution based on home assistant and esphome. Most important, with a high Wife Acceptance Factor.">
<meta name=application-name content="Lezgin Bakircioglu">
<meta name=apple-mobile-web-app-title content="Lezgin Bakircioglu">
<meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/><link rel=next href=https://lezg.in/fridge-cam-with-home-assistant-and-machine-learning/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload="this.onload=null,this.rel='stylesheet'" href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css>
<noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css></noscript><link rel=preload as=style onload="this.onload=null,this.rel='stylesheet'" href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css>
<noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Adding an API to my grind and brew coffee machine to make it smart","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lezg.in\/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart\/"},"image":[{"@type":"ImageObject","url":"https:\/\/lezg.in\/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart\/featured-image.jpg","width":1125,"height":431}],"genre":"posts","wordcount":2026,"url":"https:\/\/lezg.in\/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart\/","datePublished":"2021-02-19T21:29:01+08:00","dateModified":"2022-01-11T11:37:04+01:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/lezg.in\/images\/avatar.webp","width":528,"height":560}},"author":{"@type":"Person","name":"lerra"},"description":"This post will guide you through on how to connect a dumb Philips grind \u0026 brew hd7762 coffee machine to your privacy first home automation solution based on home assistant and esphome. Most important, with a high Wife Acceptance Factor."}</script></head>
<body header-desktop=normal header-mobile=normal><script type=text/javascript>function setTheme(a){document.body.setAttribute('theme',a)}function saveTheme(a){window.localStorage&&localStorage.setItem('theme',a)}function getMeta(b){const a=document.getElementsByTagName('meta');for(let c=0;c<a.length;c++)if(a[c].getAttribute('name')===b)return a[c];return''}if(window.localStorage&&localStorage.getItem('theme')){let a=localStorage.getItem('theme');a==='light'||a==='dark'||a==='black'?setTheme(a):window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?setTheme('dark'):setTheme('light')}else'dark'==='light'||'dark'==='dark'||'dark'==='black'?(setTheme('dark'),saveTheme('dark')):(saveTheme('auto'),window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?setTheme('dark'):setTheme('light'));let metaColors={light:'#f8f8f8',dark:'#252627',black:'#000000'};getMeta('theme-color').content=metaColors[document.body.getAttribute('theme')]</script>
<div id=back-to-top></div>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Lezgin Bakircioglu's personal space"><span id=desktop-header-typeit class=typeit></span></a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/> Posts </a><a class=menu-item href=https://github.com/lerra/lezg.in/ title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-desktop title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-desktop title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=# onclick=return!1 class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Lezgin Bakircioglu's personal space"><span id=mobile-header-typeit class=typeit></span></a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-mobile title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-mobile title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=# onclick=return!1 class=search-cancel id=search-cancel-mobile>
Cancel
</a>
</div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=https://github.com/lerra/lezg.in/ title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=# onclick=return!1 class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class=toc-content id=toc-content-auto><nav id=TableOfContents>
<ul>
<li><a href=#pre-requierments>Pre-requierments</a>
<ul>
<li><a href=#hardware-id>Hardware</a></li>
</ul>
</li>
<li><a href=#repository-id>Repository</a></li>
<li><a href=#the-story>The story</a></li>
<li><a href=#deployment>Deployment</a></li>
<li><a href=#making-it-smart-id>Making the coffee machine smart</a>
<ul>
<li><a href=#the-morning-routine-id>The morning routine (or ritual)</a></li>
<li><a href=#wfh-breaks-id>Work from home coffee breaks</a></li>
<li><a href=#start-by-voice-id>Start by voice</a></li>
<li><a href=#start-by-a-drop-id>Start by dropping the magic cube</a></li>
<li><a href=#start-through-the-app-id>Start through the app</a></li>
</ul>
</li>
</ul>
</nav></div>
</div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Adding an API to my grind and brew coffee machine to make it smart</h1><div class=post-meta>
<div class=post-meta-line>
<span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>lerra</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>category <a href=/categories/documentation/><i class="far fa-folder fa-fw"></i>Documentation</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-02-19>2021-02-19</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2022-01-11>2022-01-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2026 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;10 minutes&nbsp;</div>
</div><div class=featured-image><img class=lazyload data-src=/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg data-srcset="/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg, /adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg 1.5x, /adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg 2x" data-sizes=auto alt=/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/featured-image.jpg title="This post will guide you through on how to connect a dumb Philips grind & brew hd7762 coffee machine to your privacy first home automation solution based on home assistant and esphome. Most important, with a high Wife Acceptance Factor." height=431 width=1125></div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#pre-requierments>Pre-requierments</a>
<ul>
<li><a href=#hardware-id>Hardware</a></li>
</ul>
</li>
<li><a href=#repository-id>Repository</a></li>
<li><a href=#the-story>The story</a></li>
<li><a href=#deployment>Deployment</a></li>
<li><a href=#making-it-smart-id>Making the coffee machine smart</a>
<ul>
<li><a href=#the-morning-routine-id>The morning routine (or ritual)</a></li>
<li><a href=#wfh-breaks-id>Work from home coffee breaks</a></li>
<li><a href=#start-by-voice-id>Start by voice</a></li>
<li><a href=#start-by-a-drop-id>Start by dropping the magic cube</a></li>
<li><a href=#start-through-the-app-id>Start through the app</a></li>
</ul>
</li>
</ul>
</nav></div>
</div><div class=content id=content><p>This post will guide you through on how to connect a dumb Philips grind & brew hd7762 coffee machine to your privacy first home automation solution based on home assistant and esphome. Most important, with a high Wife Acceptance Factor.</p>
<h2 id=pre-requierments class=headerLink>
<a href=#pre-requierments class=header-mark></a>Pre-requierments</h2><p>My past experience with microcontrollers have been forced by my friend Peter to write LUA code for a rgb controller. Regarding electronics, that was my hobby before my first computer 1996 but on a basic level back then. But I am sure if there is a intresst and some time, this is doable for most of the people.</p>
<h3 id=hardware-id class=headerLink>
<a href=#hardware-id class=header-mark></a>Hardware</h3><ul>
<li>Philips Grind & Brew HD7762</li>
<li>ESP32 devkit c v4
<ul>
<li>I used ESP32 devkit c v4 30-pin but almost any ESP32 will do if you use the right pin&rsquo;s.</li>
</ul>
</li>
<li>Non-contact liquid sensor from CQRobot, other sensors can also be used to be put inside of the tank.
<ul>
<li>Not needed if you don&rsquo;t care if the coffee machine will grind & brew with out water in the tank.</li>
</ul>
</li>
<li>cables & usb power adapter.</li>
</ul>
<h2 id=repository-id class=headerLink>
<a href=#repository-id class=header-mark></a>Repository</h2><p><a href=https://github.com/lerra/home-automation/tree/main/philips_grind_and_brew_hd7762_coffee_machine/ target=_blank rel="noopener noreffer">github</a></p>
<h2 id=the-story class=headerLink>
<a href=#the-story class=header-mark></a>The story</h2><p>A couple of years ago, I started with a wake-up routine with my privacy first home automation. Waking up to an emulated sunrise with red, transforming to yellow and then to normal light over a period of fifteen minutes and then, the TV kicking on the circle of life from the Lion king movie. I could start up every morning with a smile and less grumpy.</p>
<p>So, I started to think, what&rsquo;s missing to make my mornings even more awesome. The idea with having fresh coffee would be a great. The only problem I had then was the time, then came the pandemic, as jay-z would say, I got 99 problems, but a time ain&rsquo;t one.</p>
<p>I already had some wires, ESP&rsquo;s and relays already but I was unsure how the inside of the coffee machine was wired. I was speaking to my friend Peter over the phone that is so deep into the electronics that it is insane, and I told him about what I was planning to do. He said that I might not need a relay to do this and could use the ESP to do this depending on the voltage. He found the <a href=/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/philips-service-manual-grind-and-breew-hd7762.pdf rel>service manual online</a> and was checking it but could not find any details about the circuit board. We started to disassemble the coffee machine without me really thinking it through.</p>
<p>One hour later, I measured with the multimeter to see where to hook into the circuit and we identified that the voltage is 4.3v and Peter told me that the ESP only supports 3.6V. We decided to test it out anyway and the sacrifice an ESP if it would get killed during the test as other have successfully been running even with 5V. The benefit of a successful test would be one less component (the relay).
The circuit board was a lot denser than I thought, and I have not soldered in 20 years, so we agreed that we would meet up to get some help and learn how to do it myself. It took a month before we did that due to the pandemic. Now, <strong>working from home and no coffee for a month was challenging</strong>.</p>
<p>Meanwhile, I ordered the Non-contact liquid sensor from CQRobot to be able to detect water through the plastic container (it also works through glass). With the sensor in place, I could make sure to not turn on the grinding process if the machine was not prepared. Acter a couple of weeks, I got sensor and started to play around with it and identifying exactly where to put the sensor. It&rsquo;s a really cool one and works by using the sensing capacitance of water and gives back a <a href=http://www.cqrobot.wiki/index.php/Non-contact_Water_/_Liquid_Level_Sensor#Sample_Code target=_blank rel="noopener noreffer">binary value as a result</a>.</p>
<p>So, after a month when we met and started to solder the cables to ground, the &ldquo;turn on&rdquo; button and the &ldquo;start grinding&rdquo; button. We did a test with the on button and ground connected to see if we needed a relay or not, eventually a new ESP if it would get burned during the test. It turned out that the ESP could manage it and you can see it turning on the coffee machine (the red light on the circuit).</p>
<figure><img src=code-test-optimized.gif alt="ESP32 testing"><figcaption>
<h4>Testing the code on the ESP32 to see if we need a relay or not</h4>
</figcaption>
</figure>
<p><br>To test the ESP32 if it can handle the 4.3V without burn, the following code was deployed on the ESP through <a href="https://create.arduino.cc/projecthub/Arduino_Genuino/getting-started-with-arduino-web-editor-on-various-platforms-4b3e4a?f=1" target=_blank rel="noopener noreffer">arduino studio</a> before we started to solder.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>void setup() {
  pinMode(15, OUTPUT);
}

void loop() {
  digitalWrite(15,HIGH);
  delay(5000);
  digitalWrite(15, LOW);
  delay(500);
}
</code></pre></td></tr></table>
</div>
</div><figure><img src=circuit-board-optimized.jpg alt="The curcit board of the Philips Grind & Brew HD7762" width=70% height=70%><figcaption>
<h4>The curcit board of the Philips Grind & Brew HD7762 with the cables soldered to grind and on microswitches</h4><p>The right solder joint is the on microswitch and the left one is the grind microswitch and ground was connected <a href=connecting-ground-optimized.jpg>here</a></p>
</figcaption>
</figure>
<p>So, I started to evolve the code and halfway there I bumped over an article in my rss reader about a home assistant project built upon esphome. I realized I was looking into that project a while ago but forgot the existence. Even if I have invested some time into the code, I realized that I would never come close to the features esphome. It is tightly integrated with home assistant, the possibility to update the code with the OTA (Over The Air, no need for a usb cable to debug or deploy) and a real time event source api for state & log updates and a rest api, both over json. So, I ported the code to the esphome yaml format and finished it. Bellow you can see what PIN&rsquo;s I used for the ESP32 30-pinout.</p>
<p><figure><img src=ESP32-Pinout-1.jpg alt="ESP32 PINS" width=80% height=80%><figcaption>
<h4>The ESP32 pinout</h4><p>The 30 pins ESP32 I use is a 30 pin</p>
</figcaption>
</figure>
In my case, I use the PIN D27 to connect to the &ldquo;turn on&rdquo; microswitch on the circuit, D26 is connected to the &ldquo;start grinding&rdquo; microswitch and ground to ground. For the CQRobot sensor, ground is connected to ground, VCC (red) to 3V3 and OUT to D23. This will differ depending on the ESP32 you have, checkout <a href=https://www.electronicshub.org/esp32-pinout/ target=_blank rel="noopener noreffer">electronics hub the PINs your ESP32 have</a>.</p>
<p>To make sure it would get a high <a href=https://en.wikipedia.org/wiki/Wife_acceptance_factor target=_blank rel="noopener noreffer">Wife Acceptance Factor</a> I also 3D printed a <a href=https://www.thingiverse.com/thing:3417603 target=_blank rel="noopener noreffer">case for the ESP</a> and hided it. The sensor is on the side to quickly identify if it&rsquo;s prepared without touching it as the red LED will be turned on when there is water in the tank.</p>
<figure><img src=combined-optimized.png alt="ESP32 connected to the coffee machine" width=70% height=70%><figcaption>
<h4>The ESP32 connected to the coffee machine and the water sensor</h4>
</figcaption>
</figure>
<p>Finally, I had my coffee machine back in the game after one month.</p>
<h2 id=deployment class=headerLink>
<a href=#deployment class=header-mark></a>Deployment</h2><p>Start with the PIN&rsquo;s you have on your ESP32 to adjust that (search for &ldquo;pin:") in the <a href=https://github.com/lerra/home-automation/blob/main/iot_enabling_grind_and_brew_hd7762_coffee_machine/esphome.yaml target=_blank rel="noopener noreffer">esphome file I built</a> for the coffee machine together with the cqrobot sensor. Use a USB cable for the first deployment to the ESP32, the rest of them can be done over wifi. If you use home assistant, follow the <a href=https://www.home-assistant.io/integrations/esphome/ target=_blank rel="noopener noreffer">simple steps to add esphome integration</a>. When that is done, the entities will automatically popup in home assistant. If you plan to only use the esphome exposed API&rsquo;s, you can find the docs <a href=https://esphome.io/web-api/index.html target=_blank rel="noopener noreffer">here</a>.</p>
<h2 id=making-it-smart-id class=headerLink>
<a href=#making-it-smart-id class=header-mark></a>Making the coffee machine smart</h2><p>So, what do I mean by &ldquo;smart&rdquo;? From how I see it when I can connect the coffee machine to a something bigger. So, the key is to combine it with other sensors and triggers through the privacy first home automation, home assistant. I have been using it for almost four years and it is powerful and <strong>open</strong>. You can dig deeper into <a href=https://www.home-assistant.io/getting-started/ target=_blank rel="noopener noreffer">how to get started</a> and the crazy amount of <a href=https://www.home-assistant.io/integrations/ target=_blank rel="noopener noreffer">integrations</a>.</p>
<h3 id=the-morning-routine-id class=headerLink>
<a href=#the-morning-routine-id class=header-mark></a>The morning routine (or ritual)</h3><figure><img src=wakeup-optimized.gif><figcaption>
<h4>During a 15 minute period, the wakeup routine starts with a emulated sunrise</h4>
</figcaption>
</figure>
<p>For two years ago, I started with a wake-up routine. Waking up to an emulated sunrise with red, transforming to yellow and then to normal light over a period of fifteen minutes. After a while, the TV turns on and starts the morning music with Circle of life from the Lion king movie in the front. With this, I started my mornings with a smile and less grumpy.
<p>Since I got the coffee machine a part of the home automation setup, I now start grind & brewing when a motion sensor is triggered outside of the bedroom. This is also switching the wakeup music to the morning news channel.</p></p>
<h3 id=wfh-breaks-id class=headerLink>
<a href=#wfh-breaks-id class=header-mark></a>Work from home coffee breaks</h3><p>This is a fun feature I tested but do not really use but worth sharing. By using the home assistant <a href=https://www.home-assistant.io/getting-started/presence-detection/ target=_blank rel="noopener noreffer">precense feature</a> we can have used a state if a device or a person is home or on. This could be an app on your phone reporting GPS coordinates, your work laptop connected to your network. As I am using the ESP32 that controls the coffee machine, I can also use esphome report signal measurement for <a href=https://esphome.io/components/sensor/ble_rssi.html target=_blank rel="noopener noreffer">specific bluetooth device</a> (smartwatch, phone etc.) and decide how close it is to the coffee machine. During a test I started the coffee machine during a timeslot and when presence of multiple devices but it&rsquo;s not that useful as the WFH setup during the pandemic is in the kitchen close by the coffee machine.</p>
<h3 id=start-by-voice-id class=headerLink>
<a href=#start-by-voice-id class=header-mark></a>Start by voice</h3><p>
<figure><img src=start-by-voice.gif><figcaption>
<h4>During a 15 minute period, the wakeup routine starts with a emulated sunrise</h4>
</figcaption>
</figure>
<br>You can use the [home assistant conversation](https://www.home-assistant.io/integrations/conversation/) from the computer or the app to start the coffee brewing by privacy first voice that by saying "turn on coffee maker". Honestly, the voice functionality in home assistant is limited, it's more a show then useful as you need to enter the conversation mode and then press the microphone.
<p>But if you do not mind to having a voice assistant such as Alexa or google home in your home you can get use that to kick off the coffee and then it allots more useful.</p>
</p> <br>
<h3 id=start-by-a-drop-id class=headerLink>
<a href=#start-by-a-drop-id class=header-mark></a>Start by dropping the magic cube</h3><figure><img src=aquara-magic-cube-drop.gif><figcaption>
<h4>Starting the grinding and brewing of the coffee by dropping the aquara magic cube</h4>
</figcaption>
</figure>
<p>I have several Aquara Magic Cube and I use the drop motion to kick off the coffee machine. It&rsquo;s a perfect motion when you are lazy and watching TV or in bed during the weekend when there is no wakeup routine.</p>
<h3 id=start-through-the-app-id class=headerLink>
<a href=#start-through-the-app-id class=header-mark></a>Start through the app</h3><p>This is the most used way we get our fresh coffee and it&rsquo;s nice to kick off by the end of a power walk to have it ready and fresh when we enter our home. And honestly, sometimes when automation is introduced you quickly identify the corner cases when its get triggered. And Zhuowei Zhang is spot on on his tweet,
<blockquote class=twitter-tweet data-dnt=true><p lang=en dir=ltr>Never spend 6 minutes doing something by hand when you can spend 6 hours failing to automate it</p>&mdash; Zhuowei Zhang (@zhuowei) <a href="https://twitter.com/zhuowei/status/1254266079532154880?ref_src=twsrc%5Etfw">April 26, 2020</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
</p>
<h1 id=security class=headerLink>
<a href=#security class=header-mark></a>Security</h1><p>Esphome does <a href=https://github.com/esphome/feature-requests/issues/133 target=_blank rel="noopener noreffer">not (yet) support ssl/tls</a> if you dont run a ESP8266 but it is a <a href="https://esphome.io/components/mqtt.html?highlight=fingerprint#ssl-fingerprints" target=_blank rel="noopener noreffer">poor and unsecure implementation</a>. I recommend having separate network segments for both the server & ESP32, firewall the communication and use separate wpa2 ssid for the device until there is a TLS feature.</p>
<p>Since I wrote the article, a lightweight transport encryption for the api have been added to Home Assistant 2021.10 and esphome 2021.9 A special high five to <a href=https://github.com/OttoWinter target=_blank rel="noopener noreffer">OttoWinter</a> for the <a href=https://github.com/home-assistant/core/pull/56216 target=_blank rel="noopener noreffer">feature</a>, now I am waiting for the same for mqtt ;-).</p>
<h1 id=safety class=headerLink>
<a href=#safety class=header-mark></a>Safety</h1><p>Don&rsquo;t forget to turn on the &ldquo;keep-warm&rdquo; functionality on the coffee machine, this will make the appliance to automatically turn it self off after a set time. I highly recommend it to get a safety functionality outside of the code to take care of such if something would fail.</p>
<h1 id=creds class=headerLink>
<a href=#creds class=header-mark></a>Creds</h1><p>Creds goes to the home assistant & esphome team, platform, and frameworks they have built is fantastic and I hope I could drive more users to a privacy first setup and Peter for pushing me during several years to get into the microcontrollers and electronics.</p>
<p>PS. No ESP32 got killed or injured during the test, mine have been running fine with 4.3V for two months at the time of drafting this article. Btw, feel free to send a <a href=https://github.com/lerra/lezg.in/blob/master/content/posts/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/index.en.md target=_blank rel="noopener noreffer">pull request to the article</a> or reach out on twitter if you find any errors.</p></div>
<div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2022-01-11&nbsp;<a class=git-hash href=https://github.com/lerra/lezg.in/commit/73665a10f785989f1128ed59f107422cbe0ab4d6 target=_blank title="commit by Lezgin Bakircioglu(lezgin.bakircioglu@danielwellington.com) 73665a10f785989f1128ed59f107422cbe0ab4d6: updates on time and content" rel="noopener noreferrer">
<i class="fas fa-hashtag fa-fw"></i>73665a1</a></span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span><a class=link-to-mardown href=/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/index.md target=_blank rel="noopener noreferrer">Read markdown</a>
</span><span>|&nbsp;<a class=link-to-source href=https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/index.en.md target=_blank rel="noopener noreferrer">View source</a>
</span><span>|&nbsp;<a class=link-to-edit href=https://github.com/HEIGE-PCloud/DoIt/edit/main/exampleSite/content/posts/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/index.en.md target=_blank rel="noopener noreferrer">Edit this page</a>
</span><span>|&nbsp;<a class=link-to-report href="https://github.com/HEIGE-PCloud/DoIt/issues/new?title=[bug]%20Adding+an+API+to+my+grind+and+brew+coffee+machine+to+make+it+smart&body=|Field|Value|%0A|-|-|%0A|Title|Adding+an+API+to+my+grind+and+brew+coffee+machine+to+make+it+smart|%0A|Url|https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/|%0A|Filename|https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/index.en.md|" target=_blank rel="noopener noreferrer">Report issue</a>
</span></div>
<div class=post-info-share>
<span><a href=# onclick=return!1 title="Share on Twitter" data-sharer=twitter data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/ data-title="Adding an API to my grind and brew coffee machine to make it smart" data-via=lerra82><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="Share on Facebook" data-sharer=facebook data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/><i class="fab fa-facebook-square fa-fw"></i></a><a href=# onclick=return!1 title="Share on Linkedin" data-sharer=linkedin data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/><i class="fab fa-linkedin fa-fw"></i></a><a href=# onclick=return!1 title="Share on WhatsApp" data-sharer=whatsapp data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/ data-title="Adding an API to my grind and brew coffee machine to make it smart" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=# onclick=return!1 title="Share on Hacker News" data-sharer=hackernews data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/ data-title="Adding an API to my grind and brew coffee machine to make it smart"><i class="fab fa-hacker-news fa-fw"></i></a><a href=# onclick=return!1 title="Share on Reddit" data-sharer=reddit data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/><i class="fab fa-reddit fa-fw"></i></a><a href=# onclick=return!1 title="Share on Pocket" data-sharer=pocket data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/><i class="fab fa-get-pocket fa-fw"></i></a><a href=# onclick=return!1 title="Share on Telegram" data-sharer=telegram data-url=https://lezg.in/adding-an-api-to-my-grind-and-brew-coffee-machine-to-make-it-smart/ data-title="Adding an API to my grind and brew coffee machine to make it smart" data-web><i class="fab fa-telegram-plane fa-fw"></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span>
</section>
</div>
<div class=post-nav>
<a href=/fridge-cam-with-home-assistant-and-machine-learning/ class=next rel=next title="The privacy first fridge camera that will help you know what is in the fridge during your grocery shopping">The privacy first fridge camera that will help you know what is in the fridge during your grocery shopping<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line>
Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a>&nbsp;|&nbsp;Theme - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreffer" title="DoIt 0.2.13"><i class="far fa-edit fa-fw"></i> DoIt</a>
</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
<div class=footer-line></div>
<div class=footer-line>
</div>
</div><script>'serviceWorker'in navigator&&(navigator.serviceWorker.register('/sw.min.js',{scope:'/'}).then(function(a){}),navigator.serviceWorker.ready.then(function(a){}))</script></footer></div>
<div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw"></i>
</a>
</div><div id=cookieconsent-container></div><div class=assets><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.0/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.11.0/dist/algoliasearch.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/tablesort@5.3.0/src/tablesort.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/topbar@1.0.1/topbar.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/@sliphua/pjax@2.4.0/dist/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-172523600-1',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-172523600-1" async></script></div>
<div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This page uses cookies"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"desktop-header-typeit":"Lezgin Bakircioglu","mobile-header-typeit":"Lezgin Bakircioglu"},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{algoliaAppID:"",algoliaIndex:"",algoliaSearchKey:"",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"},sharerjs:!0,table:{sort:!0},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:-1,speed:100}}</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.2/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js></script><script type=text/javascript src=/js/cookieconsent.min.js defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css></div>
</body>
</html>